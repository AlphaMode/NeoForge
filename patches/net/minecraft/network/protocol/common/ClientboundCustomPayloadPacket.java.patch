--- a/net/minecraft/network/protocol/common/ClientboundCustomPayloadPacket.java
+++ b/net/minecraft/network/protocol/common/ClientboundCustomPayloadPacket.java
@@ -2,6 +_,9 @@
 
 import com.google.common.collect.ImmutableMap;
 import java.util.Map;
+
+import io.netty.channel.ChannelHandlerContext;
+import net.minecraft.network.ConnectionProtocol;
 import net.minecraft.network.FriendlyByteBuf;
 import net.minecraft.network.protocol.Packet;
 import net.minecraft.network.protocol.common.custom.BeeDebugPayload;
@@ -51,15 +_,15 @@
       .put(WorldGenAttemptDebugPayload.ID, WorldGenAttemptDebugPayload::new)
       .build();
 
-   public ClientboundCustomPayloadPacket(FriendlyByteBuf p_295835_) {
-      this(readPayload(p_295835_.readResourceLocation(), p_295835_));
-   }
-
-   private static CustomPacketPayload readPayload(ResourceLocation p_294802_, FriendlyByteBuf p_294886_) {
-      FriendlyByteBuf.Reader<? extends CustomPacketPayload> reader = KNOWN_TYPES.get(p_294802_);
-      return (CustomPacketPayload)(reader != null ? reader.apply(p_294886_) : readUnknownPayload(p_294802_, p_294886_));
-   }
-
+   public ClientboundCustomPayloadPacket(FriendlyByteBuf p_295835_, ChannelHandlerContext context, ConnectionProtocol protocol) {
+      this(readPayload(p_295835_.readResourceLocation(), p_295835_, context, protocol));
+   }
+   
+   private static CustomPacketPayload readPayload(ResourceLocation p_294367_, FriendlyByteBuf p_294321_, ChannelHandlerContext context, ConnectionProtocol protocol) {
+      FriendlyByteBuf.Reader<? extends CustomPacketPayload> reader = net.neoforged.neoforge.network.registration.NetworkRegistry.getInstance().getReader(p_294367_, context, protocol, KNOWN_TYPES);
+      return (CustomPacketPayload)(reader != null ? reader.apply(p_294321_) : readUnknownPayload(p_294367_, p_294321_));
+   }
+   
    private static DiscardedPayload readUnknownPayload(ResourceLocation p_295991_, FriendlyByteBuf p_295803_) {
       int i = p_295803_.readableBytes();
       if (i >= 0 && i <= 1048576) {
